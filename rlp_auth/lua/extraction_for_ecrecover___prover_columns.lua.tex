% !TeX TS-program = lualatex
\documentclass[varwidth=\maxdimen,margin=0.5cm,multi={verbatim}]{standalone}

\usepackage{fontspec}
\directlua{luaotfload.add_fallback ("emojifallback", { "NotoColorEmoji:mode=harf;" })}

\setmonofont{JetBrains Mono NL Regular}[RawFeature={fallback=emojifallback}]

\usepackage{../../pkg/draculatheme}

\begin{document}
\begin{verbatim}

██\    ██\                      ██\     ██\                    ██\ ██\                           ██\
██ |   ██ |                     ██ |    \__|                   ██ |\__|                          ██ |
██ |   ██ | ██████\   ██████\ ██████\   ██\  ███████\ ██████\  ██ |██\ ████████\  ██████\   ███████ |
\██\  ██  |██  __██\ ██  __██\\_██  _|  ██ |██  _____|\____██\ ██ |██ |\____██  |██  __██\ ██  __██ |
 \██\██  / ████████ |██ |  \__| ██ |    ██ |██ /      ███████ |██ |██ |  ████ _/ ████████ |██ /  ██ |
  \███  /  ██   ____|██ |       ██ |██\ ██ |██ |     ██  __██ |██ |██ | ██  _/   ██   ____|██ |  ██ |
   \█  /   \███████\ ██ |       \████  |██ |\███████\\███████ |██ |██ |████████\ \███████\ \███████ |
    \_/     \_______|\__|        \____/ \__| \_______|\_______|\__|\__|\________| \_______| \_______|



████████\  ██████\  ███████\  ████████\  ██████\   ██████\  ██\    ██\ ████████\ ███████\
██  _____|██  __██\ ██  __██\ ██  _____|██  __██\ ██  __██\ ██ |   ██ |██  _____|██  __██\
██ |      ██ /  \__|██ |  ██ |██ |      ██ /  \__|██ /  ██ |██ |   ██ |██ |      ██ |  ██ |
█████\    ██ |      ███████  |█████\    ██ |      ██ |  ██ |\██\  ██  |█████\    ███████  |
██  __|   ██ |      ██  __██< ██  __|   ██ |      ██ |  ██ | \██\██  / ██  __|   ██  __██<
██ |      ██ |  ██\ ██ |  ██ |██ |      ██ |  ██\ ██ |  ██ |  \███  /  ██ |      ██ |  ██ |
████████\ \██████  |██ |  ██ |████████\ \██████  | ██████  |   \█  /   ████████\ ██ |  ██ |
\________| \______/ \__|  \__|\________| \______/  \______/     \_/    \________|\__|  \__|



                    ██\
                    ██ |
 ███████\  ██████\  ██ |██\   ██\ ██████\████\  ███████\
██  _____|██  __██\ ██ |██ |  ██ |██  _██  _██\ ██  __██\
██ /      ██ /  ██ |██ |██ |  ██ |██ / ██ / ██ |██ |  ██ |
██ |      ██ |  ██ |██ |██ |  ██ |██ | ██ | ██ |██ |  ██ |
\███████\ \██████  |██ |\██████  |██ | ██ | ██ |██ |  ██ |
 \_______| \______/ \__| \______/ \__| \__| \__|\__|  \__|



       ██\            ██████\  ██\           ██\   ██\     ██\
      ██ |          ██  __██\ \__|          \__|  ██ |    \__|
 ███████ | ██████\  ██ /  \__|██\ ███████\  ██\ ██████\   ██\  ██████\  ███████\   ███████\
██  __██ |██  __██\ ████\     ██ |██  __██\ ██ |\_██  _|  ██ |██  __██\ ██  __██\ ██  _____|
██ /  ██ |████████ |██  _|    ██ |██ |  ██ |██ |  ██ |    ██ |██ /  ██ |██ |  ██ |\██████\
██ |  ██ |██   ____|██ |      ██ |██ |  ██ |██ |  ██ |██\ ██ |██ |  ██ |██ |  ██ | \____██\
\███████ |\███████\ ██ |      ██ |██ |  ██ |██ |  \████  |██ |\██████  |██ |  ██ |███████  |
 \_______| \_______|\__|      \__|\__|  \__|\__|   \____/ \__| \______/ \__|  \__|\_______/




##########################################################################################

NOTE. The following defines columns in the arithmetization which extract the data required
by the prover to handle the ECRECOVER attempts associated with a particular authority list
tuple. Such attempts are made whenever

        xtern/AUTHORITY_ECRECOVER_ATTEMPT ≡ <true>

##########################################################################################



(module rlpauth)

(defun (rlpauth-ecrecover-trigger) (*  XTERN  xtern/AUTHORITY_ECRECOVER_ATTEMPT))

(defconst
  ROFF___Y         7
  ROFF___R_HI      6
  ROFF___R_LO      5
  ROFF___S_HI      4
  ROFF___S_LO      3
  ROFF___ADDR_HI   2
  ROFF___ADDR_LO   1
  ROFF___SUC_BIT   0
  )

(defun   (macro-selector---y-parity)      (shift   (rlpauth-ecrecover-trigger)   ROFF___Y       ))
(defun   (macro-selector---r-hi)          (shift   (rlpauth-ecrecover-trigger)   ROFF___R_HI    ))
(defun   (macro-selector---r-lo)          (shift   (rlpauth-ecrecover-trigger)   ROFF___R_LO    ))
(defun   (macro-selector---s-hi)          (shift   (rlpauth-ecrecover-trigger)   ROFF___S_HI    ))
(defun   (macro-selector---s-lo)          (shift   (rlpauth-ecrecover-trigger)   ROFF___S_LO    ))
(defun   (xtern-selector---address-hi)    (shift   (rlpauth-ecrecover-trigger)   ROFF___ADDR_HI ))
(defun   (xtern-selector---address-lo)    (shift   (rlpauth-ecrecover-trigger)   ROFF___ADDR_LO ))
(defun   (xtern-selector---success-bit)   (shift   (rlpauth-ecrecover-trigger)   ROFF___SUC_BIT ))
(defun   (message-selector)               (*  UTILS  utils/LIMB_BIT))


(defun   (ecrecover-limb---y-parity)      (shift   macro/Y_PARITY                     (-  ROFF___Y        1)  ))
(defun   (ecrecover-limb---r-hi)          (shift   macro/SIG_R_HI                     (-  ROFF___R_HI     1)  ))
(defun   (ecrecover-limb---r-lo)          (shift   macro/SIG_R_LO                     (-  ROFF___R_LO     1)  ))
(defun   (ecrecover-limb---s-hi)          (shift   macro/SIG_S_HI                     (-  ROFF___S_HI     1)  ))
(defun   (ecrecover-limb---s-lo)          (shift   macro/SIG_S_LO                     (-  ROFF___S_LO     1)  ))
(defun   (ecrecover-limb---address-hi)    (shift   xtern/ADDRESS_HI                       ROFF___ADDR_HI      ))
(defun   (ecrecover-limb---address-lo)    (shift   xtern/ADDRESS_LO                       ROFF___ADDR_LO      ))
(defun   (ecrecover-limb---success-bit)   (shift   xtern/AUTHORITY_RECOVERY_SUCCESS       ROFF___SUC_BIT      ))


(defcomputed    (ecrecover-extraction---IS_SIGNATURE)
                (+   (macro-selector---y-parity)
                     (macro-selector---r-hi)
                     (macro-selector---r-lo)
                     (macro-selector---s-hi)
                     (macro-selector---s-lo)
                     ))

(defcomputed    (ecrecover-extraction---IS_RESULT)
                (+   (xtern-selector---address-hi)
                     (xtern-selector---address-lo)
                     (xtern-selector---success-bit)
                     ))

(defcomputed    (ecrecover-extraction---IS_MESSAGE)
                (message-selector)
                )

(defcomputed    (ecrecover-extraction---USER_TXN_NUMBER)
                (*   (+  (ecrecover-extraction---IS_SIGNATURE)
                         (ecrecover-extraction---IS_RESULT)
                         (ecrecover-extraction---IS_MESSAGE))
                     USER_TXN_NUMBER
                     ))

(defcomputed    (ecrecover-extraction---TUPLE_INDEX)
                (*   (+  (ecrecover-extraction---IS_SIGNATURE)
                         (ecrecover-extraction---IS_RESULT)
                         (ecrecover-extraction---IS_MESSAGE))
                     TUPLE_INDEX
                     ))

(defcomputed    (ecrecover-extraction---LIMB)
                (+  (*  (macro-selector---y-parity)        (ecrecover-limb---y-parity)           )
                    (*  (macro-selector---r-hi)            (ecrecover-limb---r-hi)               )
                    (*  (macro-selector---r-lo)            (ecrecover-limb---r-lo)               )
                    (*  (macro-selector---s-hi)            (ecrecover-limb---s-hi)               )
                    (*  (macro-selector---s-lo)            (ecrecover-limb---s-lo)               )
                    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                    (*  (xtern-selector---address-hi)         (ecrecover-limb---address-hi)      )
                    (*  (xtern-selector---address-lo)         (ecrecover-limb---address-lo)      )
                    (*  (xtern-selector---success-bit)        (ecrecover-limb---success-bit)     )
                    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                    (*  (ecrecover-extraction---IS_MESSAGE)         utils/LIMB_INDEX             )
                    ))

(defcomputed    (ecrecover-extraction---LIMB_SIZE)
                (*  (ecrecover-extraction---IS_MESSAGE) utils/LIMB_SIZE)
                )

(defcomputed    (ecrecover-extraction---LIMB_INDEX)
                (+  (*  (macro-selector---y-parity)        0                         )
                    (*  (macro-selector---r-hi)            1                         )
                    (*  (macro-selector---r-lo)            2                         )
                    (*  (macro-selector---s-hi)            3                         )
                    (*  (macro-selector---s-lo)            4                         )
                    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                    (*  (xtern-selector---address-hi)         0                      )
                    (*  (xtern-selector---address-lo)         1                      )
                    (*  (xtern-selector---success-bit)        2                      )
                    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                    (*  (ecrecover-extraction---IS_MESSAGE)         utils/LIMB_INDEX )
                    ))

\end{verbatim}
\end{document}
