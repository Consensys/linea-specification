% !TeX TS-program = lualatex
\documentclass[varwidth=\maxdimen,margin=0.5cm,multi={verbatim}]{standalone}
\usepackage{../../pkg/draculatheme}
\usepackage{fontspec}
\directlua{luaotfload.add_fallback
   ("emojifallback",
    {
      "NotoColorEmoji:mode=harf;"
    }
   )}

\setmonofont{JetBrains Mono NL Regular}[
  RawFeature={fallback=emojifallback}
]

\usepackage{../../pkg/draculatheme}

\begin{document}
\begin{verbatim}
                                                                           ██\   ██\ ██\   ██\ ███████\              ██\       ██\      ██\ ██\      ██\ ██\   ██\       ██\            ██\                          ██████\                               
                                                                           ██ |  ██ |██ |  ██ |██  __██\            ██  |      ███\    ███ |███\    ███ |██ |  ██ |      \__|           ██ |                        ██  __██\                              
                                                                           ██ |  ██ |██ |  ██ |██ |  ██ |          ██  /       ████\  ████ |████\  ████ |██ |  ██ |      ██\ ███████\ ██████\    ██████\   ██████\  ██ /  \__|██████\   ███████\  ██████\  
                                                                           ████████ |██ |  ██ |███████\ |         ██  /        ██\██\██ ██ |██\██\██ ██ |██ |  ██ |      ██ |██  __██\\_██  _|  ██  __██\ ██  __██\ ████\     \____██\ ██  _____|██  __██\ 
                                                                           ██  __██ |██ |  ██ |██  __██\         ██  /         ██ \███  ██ |██ \███  ██ |██ |  ██ |      ██ |██ |  ██ | ██ |    ████████ |██ |  \__|██  _|    ███████ |██ /      ████████ |
                                                                           ██ |  ██ |██ |  ██ |██ |  ██ |       ██  /          ██ |\█  /██ |██ |\█  /██ |██ |  ██ |      ██ |██ |  ██ | ██ |██\ ██   ____|██ |      ██ |     ██  __██ |██ |      ██   ____|
                                                                           ██ |  ██ |\██████  |███████  |      ██  /           ██ | \_/ ██ |██ | \_/ ██ |\██████  |      ██ |██ |  ██ | \████  |\███████\ ██ |      ██ |     \███████ |\███████\ \███████\ 
                                                                           \__|  \__| \______/ \_______/       \__/            \__|     \__|\__|     \__| \______/       \__|\__|  \__|  \____/  \_______|\__|      \__|      \_______| \_______| \_______|



|--------------------------------------+----------------------------------+--------------+-------------+-----------+------------+-------------------+------------+---------------+---------+---------------+------------------------+--------------------+--------------------+------------------+----------------------------|
| ⟦MMU_INST_xxx⟧                       | EVM instruction / use case       | SRC_ID       | TGT_ID      | AUX_ID    | SRC_OFF_HI | SCR_OFF_LO        | TGT_OFF_LO | SIZE          | REF_OFF | REF_SIZE      | SUCCESS_BIT            | LIMB_1             | LIMB_2             | PHASE            | EXO_SUM                    |
|--------------------------------------+----------------------------------+--------------+-------------+-----------+------------+-------------------+------------+---------------+---------+---------------+------------------------+--------------------+--------------------+------------------+----------------------------|
| ⟦MMU_INST_mload⟧                     | MLOAD                            | CN           |             |           |            | µ[0]_lo           |            |               |         |               |                        | ⟦ π ⟧              | ⟦ π ⟧              |                  |                            |
|                                      | MODEXP_extract_raw_lead          | CN           |             |           |            | cdo + 96 + bbs    |            |               |         |               |                        | ⟦ π ⟧ raw_lead_hi  | ⟦ π ⟧ raw_lead_lo  |                  |                            |
|--------------------------------------+----------------------------------+--------------+-------------+-----------+------------+-------------------+------------+---------------+---------+---------------+------------------------+--------------------+--------------------+------------------+----------------------------|
| ⟦MMU_INST_mstore⟧                    | MSTORE                           |              | CN          |           |            |                   | µ[0]_lo    |               |         |               |                        | µ[1]_hi            | µ[1]_lo            |                  |                            |
|                                      | SHA2-256_transfer_trivial_res    |              | 1 + HUB_   |           |            |                   | 0          |               |         |               |                        | SHA2-256(( ))_hi   | SHA2-256(( ))_lo   |                  |                            |
|                                      | RIPEMD-160_transfer_trivial_res  |              | 1 + HUB_   |           |            |                   | 0          |               |         |               |                        | RIPEMD-160(( ))_hi | RIPEMD-160(( ))_lo |                  |                            |
|                                      | ECPAIRING_transfer_trivial_res   |              | 1 + HUB_   |           |            |                   | 0          |               |         |               |                        | 0x 00 .. 00 00     | 0x 00 ... 00 01    |                  |                            |
|--------------------------------------+----------------------------------+--------------+-------------+-----------+------------+-------------------+------------+---------------+---------+---------------+------------------------+--------------------+--------------------+------------------+----------------------------|
| ⟦MMU_INST_mstore8⟧                   | MSTORE8                          |              | CN          |           |            |                   | µ[0]_lo    |               |         |               |                        | µ[1]_hi            | µ[1]_lo            |                  |                            |
|--------------------------------------+----------------------------------+--------------+-------------+-----------+------------+-------------------+------------+---------------+---------+---------------+------------------------+--------------------+--------------------+------------------+----------------------------|
| ⟦MMU_INST_invalidCodePrefix⟧         | (RETURN in dep. cn. w/ size ≠ 0) | CN           |             |           |            | µ[0]_lo           |            |               |         |               | ⟦ π ⟧ lead_is_0xEF     |                    |                    |                  |                            |
|--------------------------------------+----------------------------------+--------------+-------------+-----------+------------+-------------------+------------+---------------+---------+---------------+------------------------+--------------------+--------------------+------------------+----------------------------|
| ⟦MMU_INST_rightPaddedWordExtraction⟧ | CALLDATALOAD (non root context)  | CALLER_CN    |             |           |            | µ[0]_lo           |            |               | cdo     | cds           |                        | ⟦ π ⟧              | ⟦ π ⟧              |                  |                            |
|                                      | MODEXP_extract_byte_size_param   | CN           |             |           |            | x_off = 0, 32, 64 |            |               | cdo     | cds           |                        | ⟦ π ⟧ xbs_hi       | ⟦ π ⟧ xbs_lo       |                  |                            |
|--------------------------------------+----------------------------------+--------------+-------------+-----------+------------+-------------------+------------+---------------+---------+---------------+------------------------+--------------------+--------------------+------------------+----------------------------|
| ⟦MMU_INST_ramToExoWithPadding⟧       |                                  |              |             |           |            |                   |            |               |         |               |                        |                    |                    |                  |                            |
|                                      | SHA3                             | CN           |             | 1 + HUB_ |            | µ[0]_lo           |            | µ[1]_lo       |         | µ[1]_lo       |                        |                    |                    | (set by MMIO)    | .               ⟦1 << kec⟧ |
|                                      | CREATE2 (failure condition)      | CN           |             | 1 + HUB_ |            | µ[0]_lo           |            | µ[1]_lo       |         | µ[1]_lo       |                        |                    |                    | (set by MMIO)    | .               ⟦1 << kec⟧ |
|                                      | CREATE2                          | CN           | CFI         | 1 + HUB_ |            | µ[1]_lo           |            | µ[2]_lo       |         | µ[2]_lo       |                        |                    |                    | (set by MMIO)    | ⟦1 << rom⟧    + ⟦1 << kec⟧ |
|                                      | CREATE                           | CN           | CFI         |           |            | µ[1]_lo           |            | µ[2]_lo       |         | µ[2]_lo       |                        |                    |                    |                  | ⟦1 << rom⟧                 |
|                                      | RETURN (from deployment)         | CN           | CFI         | 1 + HUB_ |            | µ[0]_lo           |            | µ[1]_lo       |         | µ[1]_lo       |                        |                    |                    | (set by MMIO)    | ⟦1 << rom⟧    + ⟦1 << kec⟧ |
| (don't actually pad !)               | LOG0-4                           | CN           | ABS_LOG_NUM |           |            | µ[0]_lo           |            | µ[1]_lo       |         | µ[1]_lo       |                        |                    |                    |                  | ⟦1 << log⟧                 |
|                                      | SHA2-256_extract                 | CN           | 1 + HUB_   |           |            | cdo               |            | cds           |         | cds           |                        |                    |                    | Φ_sha2_data      | ⟦1 << ripsha⟧              |
|                                      | RIPEMD-160_extract               | CN           | 1 + HUB_   |           |            | cdo               |            | cds           |         | cds           |                        |                    |                    | Φ_ripemd_data    | ⟦1 << ripsha⟧              |
|                                      | ECPAIRING_extract                | CN           | 1 + HUB_   |           |            | cdo               |            | cds = 192 • k |         | cds = 192 • k | ⟦ π ⟧ well_formed      |                    |                    | Φ_ecpairing_data | ⟦1 << ecdata⟧              |
|                                      | BLAKE2f_h_m_t_extract            | CN           | 1 + HUB_   |           |            | cdo + 4           |            | 208           |         | 208           |                        |                    |                    | Φ_blake_data     | ⟦1 << blake⟧               |
|                                      |                                  |              |             |           |            |                   |            |               |         |               |                        |                    |                    |                  |                            |
|                                      | ECRECOVER_extract                | CN           | 1 + HUB_   |           |            | cdo               |            | cds           |         | 128           | ⟦ π ⟧ recovery_success |                    |                    | Φ_ecrec_data     | ⟦1 << ecdata⟧              |
| (can actually pad !)                 | ECADD_extract                    | CN           | 1 + HUB_   |           |            | cdo               |            | cds           |         | 128           | ⟦ π ⟧ well_formed      |                    |                    | Φ_ecadd_data     | ⟦1 << ecdata⟧              |
|                                      | ECMUL_extract                    | CN           | 1 + HUB_   |           |            | cdo               |            | cds           |         | 96            | ⟦ π ⟧ well_formed      |                    |                    | Φ_ecmul_data     | ⟦1 << ecdata⟧              |
|--------------------------------------+----------------------------------+--------------+-------------+-----------+------------+-------------------+------------+---------------+---------+---------------+------------------------+--------------------+--------------------+------------------+----------------------------|
| ⟦MMU_INST_exoToRamTransplants⟧       | ECRECOVER_transfer_res           | 1 + HUB_    | 1 + HUB_   |           |            |                   |            | 32            |         |               |                        |                    |                    | Φ_ecrec_res      | ⟦1 << ecdata⟧              |
|                                      | SHA2-256_transfer_res            | 1 + HUB_    | 1 + HUB_   |           |            |                   |            | 32            |         |               |                        |                    |                    | Φ_sha2_res       | ⟦1 << ripsha⟧              |
|                                      | RIPEMD-160_transfer_res          | 1 + HUB_    | 1 + HUB_   |           |            |                   |            | 32            |         |               |                        |                    |                    | Φ_ripemd_res     | ⟦1 << ripsha⟧              |
|                                      | MODEXP_transfer_res              | 1 + HUB_    | 1 + HUB_   |           |            |                   |            | 512           |         |               |                        |                    |                    | Φ_modexp_res     | ⟦1 << modexp⟧              |
|                                      | ECADD_transfer_res               | 1 + HUB_    | 1 + HUB_   |           |            |                   |            | 64            |         |               |                        |                    |                    | Φ_ecadd_res      | ⟦1 << ecdata⟧              |
|                                      | ECMUL_transfer_res               | 1 + HUB_    | 1 + HUB_   |           |            |                   |            | 64            |         |               |                        |                    |                    | Φ_ecmul_res      | ⟦1 << ecdata⟧              |
|                                      | ECPAIRING_transfer_res           | 1 + HUB_    | 1 + HUB_   |           |            |                   |            | 32            |         |               |                        |                    |                    | Φ_ecpairing_res  | ⟦1 << ecdata⟧              |
|                                      | BLAKE2f_transfer_res             | 1 + HUB_    | 1 + HUB_   |           |            |                   |            | 64            |         |               |                        |                    |                    | Φ_blake_res      | ⟦1 << blake⟧               |
|                                      |                                  |              |             |           |            |                   |            |               |         |               |                        |                    |                    |                  |                            |
|                                      | TRANSACTION_CALL_DATA_transfer   | ABS_TX_NUM   | HUB_       |           |            |                   |            | txcd_size     |         |               |                        |                    |                    |                  | ⟦1 << rlp_txn⟧             |
|--------------------------------------+----------------------------------+--------------+-------------+-----------+------------+-------------------+------------+---------------+---------+---------------+------------------------+--------------------+--------------------+------------------+----------------------------|
| ⟦MMU_INST_ramToRamSansPadding⟧       | REVERT                           | CN           | CALLER_CN   |           |            | µ[0]_lo           |            | µ[1]_lo       | r@o     | r@c           |                        |                    |                    |                  |                            |
|                                      | RETURN_fromMessageCall           | CN           | CALLER_CN   |           |            | µ[0]_lo           |            | µ[1]_lo       | r@o     | r@c           |                        |                    |                    |                  |                            |
|                                      | ECRECOVER_partial_copy           | 1 + HUB_    | CN          |           |            | 0                 |            | 32            | r@o     | r@c           |                        |                    |                    |                  |                            |
|                                      | SHA2-256_partial_copy            | 1 + HUB_    | CN          |           |            | 0                 |            | 32            | r@o     | r@c           |                        |                    |                    |                  |                            |
|                                      | RIPEMD-160_partial_copy          | 1 + HUB_    | CN          |           |            | 0                 |            | 32            | r@o     | r@c           |                        |                    |                    |                  |                            |
|                                      | IDENTITY_extract                 | CN           | 1 + HUB_   |           |            | cdo               |            | cds           | 0       | cds           |                        |                    |                    |                  |                            |
|                                      | IDENTITY_partial_copy            | 1 + HUB_    | CN          |           |            | 0                 |            | cds           | r@o     | r@c           |                        |                    |                    |                  |                            |
|                                      | MODEXP_partial_copy              | 1 + HUB_    | CN          |           |            | 512 - mbs         |            | mbs           | r@o     | r@c           |                        |                    |                    |                  |                            |
|                                      | ECADD_partial_copy               | 1 + HUB_    | CN          |           |            | 0                 |            | 64            | r@o     | r@c           |                        |                    |                    |                  |                            |
|                                      | ECMUL_partial_copy               | 1 + HUB_    | CN          |           |            | 0                 |            | 64            | r@o     | r@c           |                        |                    |                    |                  |                            |
|                                      | ECPAIRING_partial_copy           | 1 + HUB_    | CN          |           |            | 0                 |            | 32            | r@o     | r@c           |                        |                    |                    |                  |                            |
|                                      | BLAKE2f_partial_copy             | 1 + HUB_    | CN          |           |            | 0                 |            | 64            | r@o     | r@c           |                        |                    |                    |                  |                            |
|--------------------------------------+----------------------------------+--------------+-------------+-----------+------------+-------------------+------------+---------------+---------+---------------+------------------------+--------------------+--------------------+------------------+----------------------------|
| ⟦MMU_ISNT_anyToRamWithPadding⟧       | CALLDATACOPY                     | CALL_DATA_CN | CN          |           | µ[1]_hi    | µ[1]_lo           | µ[0]_lo    | µ[2]_lo       | cdo     | cds           |                        |                    |                    |                  | 0                          |
|                                      | RETURNDATACOPY                   | RETURNER_CN  | CN          |           | µ[1]_hi    | µ[1]_lo           | µ[0]_lo    | µ[2]_lo       | rdo     | rds           |                        |                    |                    |                  | 0                          |
|                                      | CODECOPY                         | CFI          | CN          |           | µ[1]_hi    | µ[1]_lo           | µ[0]_lo    | µ[2]_lo       | 0       | codesize      |                        |                    |                    |                  | ⟦1 << rom⟧                 |
|                                      | EXTCODECOPY                      | CFI          | CN          |           | µ[2]_hi    | µ[2]_lo           | µ[1]_lo    | µ[3]_lo       | 0       | codesize      |                        |                    |                    |                  | ⟦1 << rom⟧                 |
|--------------------------------------+----------------------------------+--------------+-------------+-----------+------------+-------------------+------------+---------------+---------+---------------+------------------------+--------------------+--------------------+------------------+----------------------------|
| ⟦MMU_INST_modexpZero⟧                | MODEXP_zero_base                 |              | 1 + HUB_   |           |            |                   |            |               |         |               |                        |                    |                    | Φ_base           | ⟦1 << modexp⟧              |
|                                      | MODEXP_zero_exponent             |              | 1 + HUB_   |           |            |                   |            |               |         |               |                        |                    |                    | Φ_exponent       | ⟦1 << modexp⟧              |
|--------------------------------------+----------------------------------+--------------+-------------+-----------+------------+-------------------+------------+---------------+---------+---------------+------------------------+--------------------+--------------------+------------------+----------------------------|
| ⟦MMU_INST_modexpData⟧                | MODEXP_extract_base              | CN           | 1 + HUB_   |           |            | 96                |            | bbs           | cdo     | cds           |                        |                    |                    | Φ_base           | ⟦1 << modexp⟧              |
|                                      | MODEXP_extract_exponent          | CN           | 1 + HUB_   |           |            | 96 + bbs          |            | ebs           | cdo     | cds           |                        |                    |                    | Φ_exponent       | ⟦1 << modexp⟧              |
|                                      | MODEXP_extract_modulus           | CN           | 1 + HUB_   |           |            | 96 + bbs + ebs    |            | mbs           | cdo     | cds           |                        |                    |                    | Φ_modulus        | ⟦1 << modexp⟧              |
|--------------------------------------+----------------------------------+--------------+-------------+-----------+------------+-------------------+------------+---------------+---------+---------------+------------------------+--------------------+--------------------+------------------+----------------------------|
| ⟦MMU_INST_blake⟧                     | BLAKE2f_extract_r_and_f          | CN           | 1 + HUB_   |           |            | cdo               |            |               |         |               | ⟦ π ⟧ blake_b_success  | ⟦ π ⟧ rounds       | ⟦ π ⟧ f            |                  |                            |
|--------------------------------------+----------------------------------+--------------+-------------+-----------+------------+-------------------+------------+---------------+---------+---------------+------------------------+--------------------+--------------------+------------------+----------------------------|

COMMENTS:
* for the nontrivial data transfer of
    - SHA3           [see comment below]
    - RETURN (deployments)
    - LOG0-4         [see comment below]
    - CREATE
    - CREATE2
    - SHA2-256
    - RIPEMD-160
    - ECPAIRING
  we must also communicate the SIZE to the target data module; for SHA3 the SIZE is available in the HASH_INFO module; for LOG0-4 the SIZE is available in the LOG_INFO module; yet we may add these values anyways for greater uniformity;

* for the ⟦MMU_INST_blake⟧ instruction the MMU module sets its own EXO_SUM and PHASE depending on the SUCCESS_BIT.
    - if SUCCESS_BIT = 0:
        - EXO_SUM ≡ 0
        - PHASE   ≡ 0
    - if SUCCESS_BIT = 1:
        - EXO_SUM ≡ ⟦1 << blake⟧
        - PHASE   ≡ Φ_blake_params

\end{verbatim}
\end{document}
