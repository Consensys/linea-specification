% TODO: merge

We impose the following constraints on \cOneMembershipTestRequired{}:
\begin{enumerate}
    \item \cOneMembershipTestRequired{} is \textbf{counter-constant, binary} \quad (\trash)
    \item
        \[  
            \cOneMembershipTestRequired_{i} = 
            \left[ \begin{array}{clcr}
              + & \malformedDataExternalBit \cdot \isBlsGOneAddData_{i} \\
              + & \malformedDataExternalBit \cdot \isBlsGOneMsmData_{i} \cdot \isFirstInput \\
            \end{array} \right] \vspace{2mm}  
        \]
\end{enumerate}
\noindent
We impose the following constraints on \cTwoMembershipTestRequired{}:
\begin{enumerate}
    \item \cTwoMembershipTestRequired{} is \textbf{counter-constant, binary} \quad (\trash)
    \item 
    \[  
        \cTwoMembershipTestRequired_{i} = 
        \left[ \begin{array}{clcr}
          + & \malformedDataExternalBit \cdot \isBlsGTwoAddData_{i} \\
          + & \malformedDataExternalBit \cdot \isBlsGTwoMsmData_{i} \cdot \isFirstInput \\
        \end{array} \right] \vspace{2mm}  
    \]
\end{enumerate}
\noindent
We impose the following constraints on \gOneMembershipTestRequired{}:
\begin{enumerate}
    \item \gOneMembershipTestRequired{} is \textbf{counter-constant, binary} \quad (\trash)
    \item 
        \[
            \gOneMembershipTestRequired_{i} = 
                \left[ \begin{array}{cl} 
                    + & \isBlsGOneMsmData_{i} \cdot \isFirstInput \cdot \malformedDataExternalBit_{i}  \\
                    + & \isBlsPairingCheckData_{i} \cdot \isFirstInput \cdot \malformedDataExternalBit_{i} \\
                    + & \isBlsPairingCheckData_{i} \cdot \isFirstInput \cdot \locWellformedData_{i} \cdot \\
                      & \pairOfPointsContainsInfinity_{i} \cdot (1 - \isInfinity_{i}) \\
                \end{array} \right] \\
        \]
\end{enumerate}
\noindent
We impose the following constraints on \gTwoMembershipTestRequired{}:
\begin{enumerate}
    \item \gTwoMembershipTestRequired{} is \textbf{counter-constant, binary} \quad (\trash)
    \item 
        \[
            \gTwoMembershipTestRequired_{i} = 
                \left[ \begin{array}{cl} 
                    + & \isBlsGTwoMsmData_{i} \cdot \isFirstInput \cdot \malformedDataExternalBit_{i}  \\
                    + & \isBlsPairingCheckData_{i} \cdot \isSecondInput \cdot \malformedDataExternalBit_{i} \\
                    + & \isBlsPairingCheckData_{i} \cdot \isSecondInput \cdot \locWellformedData_{i} \cdot \\
                    & \pairOfPointsContainsInfinity_{i} \cdot (1 - \isInfinity_{i}) \\
                \end{array} \right] \\
        \]
\end{enumerate}

% TODO: adapt
% \saNote{} The purpose of \membershipTestRequired{} is twofold:
% (\emph{a}) in case the present module predicts that some point in the data of a call to the \inst{ECPAIRING} precompile is not on $G_2$ the \membershipTestRequired{} flag selects that point, see section~(\ref{prc: ec data: successful pairing: setting G2 non membership})
% (\emph{b}) in case the present module predicts that all points in the data of the same call are on $G_2$ the \membershipTestRequired{} flag selects for every pair of points $(P,Q)$ those $Q$ whose accompanying $P$ is the point at infinity, see section~(\ref{prc: ec data: successful pairing: setting membershipTestRequired}).

We now define the behaviour of the various circuit selectors.
\begin{description}
    \item[Circuit selector for the \inst{PointEvaluation} circuit:]
        $\csPointEvaluation_{i} = \locIsPointEvaluation_{i} \cdot \wellformedDataNonTrivial_{i}$
    \item[Circuit selector for the \inst{G1ADD} circuit:]
        $\csGOneAdd_{i} = \locIsBlsGOneAdd_{i} \cdot \wellformedDataNonTrivial_{i}$
    \item[Circuit selector for the \inst{G1MSM} circuit:]
        $\csGOneMsm_{i} = \locIsBlsGOneMsm_{i} \cdot \wellformedDataNonTrivial_{i}$
    \item[Circuit selector for the \inst{G2ADD} circuit:]
        $\csGTwoAdd_{i} = \locIsBlsGTwoAdd_{i} \cdot \wellformedDataNonTrivial_{i}$
    \item[Circuit selector for the \inst{G2MSM} circuit:]
        $\csGTwoMsm_{i} = \locIsBlsGTwoMsm_{i} \cdot \wellformedDataNonTrivial_{i}$
    \item[Circuit selector for the \inst{PAIRING\_CHECK} circuit:]
    we introduce the following shorthands:
    \[
        \begin{array}{lcl}
            \locCsGOnePairingMalformed_{i} & \define &
            \left[ \begin{array}{clcr}
                \cdot & \locIsBlsPairingCheck_{i}                        \\
                \cdot & \malformedDataExternalBit_{i}                            \\
                \cdot & \isFirstInput_{i}                                \\
            \end{array} \right] \vspace{2mm}                             \\

            \locCsGOnePairingWellformed_{i} & \define &
            \left[ \begin{array}{clcr}
                \cdot & \locIsBlsPairingCheck_{i}                        \\
                \cdot & \locWellformedData_{i}                           \\
                \cdot & \isFirstInput_{i}                                \\
                \cdot & (1 - \isInfinity_{i})                            \\
                \cdot & \pairOfPointsContainsInfinity_{i}                \\
            \end{array} \right] \vspace{2mm}                             \\

            \locCsGOnePairing_{i} & \define &
            \left[ \begin{array}{clcr}
                + & \locCsGOnePairingMalformed_{i}                       \\
                + & \locCsGOnePairingWellformed_{i}                      \\
            \end{array} \right] \vspace{2mm}                             \\

            \locCsGTwoPairingMalformed_{i} & \define &
            \left[ \begin{array}{clcr}
                \cdot & \locIsBlsPairingCheck_{i}                        \\
                \cdot & \malformedDataExternalBit_{i}                            \\
                \cdot & \isSecondInput_{i}                                \\
            \end{array} \right] \vspace{2mm}                             \\

            \locCsGTwoPairingWellformed_{i} & \define &
            \left[ \begin{array}{clcr}
                \cdot & \locIsBlsPairingCheck_{i}                        \\
                \cdot & \locWellformedData_{i}                           \\
                \cdot & \isSecondInput_{i}                                \\
                \cdot & (1 - \isInfinity_{i})                            \\
                \cdot & \pairOfPointsContainsInfinity_{i}                \\
            \end{array} \right] \vspace{2mm}                             \\

            \locCsGTwoPairing_{i} & \define &
            \left[ \begin{array}{clcr}
                + & \locCsGTwoPairingMalformed_{i}                       \\
                + & \locCsGTwoPairingWellformed_{i}                      \\
            \end{array} \right] \vspace{2mm}                             \\
        \end{array}
    \]

    we impose the following constraints:
        \begin {enumerate}
            \item 
                \[
                    \begin{array}{lcl}
                        \csPairing_{i} & = & \isBlsPairingCheckData_{i} \cdot \wellformedDataNonTrivial_{i} \cdot (1 - \pairOfPointsContainsInfinity_{i})  \\
                        & & + \isBlsPairingCheckResult_{i} \cdot \wellformedDataNonTrivial_{i} \\
                    \end{array}
                \]
            \item \If $\locIsBlsPairingCheck_{i} = 0$ \Then
                \[
                    \begin{array}{lcl}
                        \csPairing_{i} & = & 0
                    \end{array}
                \]
        \end{enumerate}
    \item[Circuit selector for the \inst{C1\_MEMBERSHIP\_TEST} circuit:]
        $\csCOne_{i} = \cOneMembershipTestRequired_{i}$
    \item[Circuit selector for the \inst{C2\_MEMBERSHIP\_TEST} circuit:]
        $\csCTwo_{i} = \cTwoMembershipTestRequired_{i}$
    \item[Circuit selector for the \inst{G1\_MEMBERSHIP\_TEST} circuit:]
        % $\csGOne_{i} = \gOneMembershipTestRequired_{i}$
        we introduce the following shorthands:
        \[
            \begin{array}{lcl}
                \locCsGOneMsm_{i} & \define &
                \left[ \begin{array}{clcr}
                    % + & \locCsGTwoPairingMalformed_{i}                       \\
                    % + & \locCsGTwoPairingWellformed_{i}                      \\
                \end{array} \right] \vspace{2mm}                             \\
            \end{array}
        \]

        we impose the following constraints:
        \[
            \csGOne_{i} = 
            \left[ \begin{array}{clcr}
                + & \isBlsPairingCheckData_{i} \cdot \locCsGOnePairing   \\
                + & \isBlsGOneMsmData_{i} \cdot \locCsGOneMsm            \\ % TODO: introduce that
            \end{array} \right] \vspace{2mm}                             \\
        \]

    \item[Circuit selector for the \inst{G2\_MEMBERSHIP\_TEST} circuit:]
        %$\csGTwo_{i} = \gTwoMembershipTestRequired_{i}$
        we introduce the following shorthands:
        \[
            \begin{array}{lcl}
                \locCsGTwoMsm_{i} & \define &
                \left[ \begin{array}{clcr}
                    % + & \locCsGTwoPairingMalformed_{i}                     \\
                    % + & \locCsGTwoPairingWellformed_{i}                    \\
                \end{array} \right] \vspace{2mm}                             \\
            \end{array}
        \]

        we impose the following constraints:
        \[
            \csGTwo_{i} = 
            \left[ \begin{array}{clcr}
                + & \isBlsPairingCheckData_{i} \cdot \locCsGTwoPairing   \\
                + & \isBlsGTwoMsmData_{i} \cdot \locCsGTwoMsm            \\ % TODO: introduce that
            \end{array} \right] \vspace{2mm}                             \\
        \]
    \item[Circuit selector for the \inst{MAP\_FP\_TO\_G1} circuit:]
        $\csMapFpToGOne_{i} = \locIsBlsMapFpToGOne_{i} \cdot \wellformedDataNonTrivial_{i}$
    \item[Circuit selector for the \inst{MAP\_FP2\_TO\_G2} circuit:]
        $\csMapFpTwoToGTwo_{i} = \locIsBlsMapFpTwoToGTwo_{i} \cdot \wellformedDataNonTrivial_{i}$
\end{description}    

Note that, at most one of the circuit selectors may light up for a given row:

\begin{enumerate}
    \item $\csPointEvaluation_{i} + \csCOne_{i} + \csGOne_{i} + \csCTwo_{i} + \csGTwo_{i} + \csPairing_{i} + \csGOneAdd_{i} + \csGTwoAdd_{i} + \csGOneMsm_{i} + \csGTwoMsm_{i} + \csMapFpToGOne_{i} + \csMapFpTwoToGTwo_{i}$ is binary \quad (\trash)
\end{enumerate}
The data that should be read by external circuits are always the following:
\begin{enumerate}
    \item \blsId{}
    \item \blsIndex{}
    \item \blsLimb{}
    \item \blsSuccessBit{}
\end{enumerate}

% \saNote{}
% Whenever $\blsSuccessBit = 0$ then $\csEcpairing = 0$, while if $\blsSuccessBit = 1$ then $\csEcpairing = \acceptablePairOfPoints$.

% \saNote{}
% Given the \blsMod{} is processing \inst{ECPAIRING} instructions, the $\csGTwo$ flag lights up under two circumstances:
% \begin{enumerate} 
% \item $\internalChecksPassed = 1$, $\blsSuccessBit = 0$ along the rows of first large point that is predicted not to lie on the $G_2$ subgroup;
% \item $\internalChecksPassed = 1$, $\blsSuccessBit = 1$ along the rows of the large point of every pair of the form $(\infty, \locB)$;
% \end{enumerate}

