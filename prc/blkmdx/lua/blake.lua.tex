% !TeX TS-program = lualatex
\documentclass[varwidth=\maxdimen,margin=0.5cm,multi={verbatim}]{standalone}

\usepackage{../../../pkg/draculatheme}

\usepackage{fontspec}
\directlua{luaotfload.add_fallback
   ("emojifallback",
    {
      "NotoColorEmoji:mode=harf;"
    }
   )}

\setmonofont{JetBrains Mono NF Regular}[
  RawFeature={fallback=emojifallback}
]

\usepackage{../../../pkg/draculatheme}

\begin{document}
\begin{verbatim}
                          ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà\  ‚ñà‚ñà\        ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà\  ‚ñà‚ñà\   ‚ñà‚ñà\ ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà\  ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà\   ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà\  
                          ‚ñà‚ñà  __‚ñà‚ñà\ ‚ñà‚ñà |      ‚ñà‚ñà  __‚ñà‚ñà\ ‚ñà‚ñà | ‚ñà‚ñà  |‚ñà‚ñà  _____|‚ñà‚ñà  __‚ñà‚ñà\ ‚ñà‚ñà  __‚ñà‚ñà\ 
                          ‚ñà‚ñà |  ‚ñà‚ñà |‚ñà‚ñà |      ‚ñà‚ñà /  ‚ñà‚ñà |‚ñà‚ñà |‚ñà‚ñà  / ‚ñà‚ñà |      \__/  ‚ñà‚ñà |‚ñà‚ñà /  \__|
                          ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà\ |‚ñà‚ñà |      ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà |‚ñà‚ñà‚ñà‚ñà‚ñà  /  ‚ñà‚ñà‚ñà‚ñà‚ñà\     ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà  |‚ñà‚ñà‚ñà‚ñà\     
                          ‚ñà‚ñà  __‚ñà‚ñà\ ‚ñà‚ñà |      ‚ñà‚ñà  __‚ñà‚ñà |‚ñà‚ñà  ‚ñà‚ñà<   ‚ñà‚ñà  __|   ‚ñà‚ñà  ____/ ‚ñà‚ñà  _|    
                          ‚ñà‚ñà |  ‚ñà‚ñà |‚ñà‚ñà |      ‚ñà‚ñà |  ‚ñà‚ñà |‚ñà‚ñà |\‚ñà‚ñà\  ‚ñà‚ñà |      ‚ñà‚ñà |      ‚ñà‚ñà |      
                          ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà  |‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà\ ‚ñà‚ñà |  ‚ñà‚ñà |‚ñà‚ñà | \‚ñà‚ñà\ ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà\ ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà\ ‚ñà‚ñà |      
                          \_______/ \________|\__|  \__|\__|  \__|\________|\________|\__|



|----+------------------+-----------+-------+----------------+---------------+-----------------+-----------------|
| ID |       PHASE      | INDEX_MAX | INDEX |      LIMB      | IS_BLAKE_DATA | IS_BLAKE_PARAMS | IS_BLAKE_RESULT |
|:--:+:----------------:+:---------:+:-----:+:--------------:+:-------------:+:---------------:+:---------------:|
|  0 |         0        |     0     |   0   |        0       |       0       |        0        |        0        |
|  ‚ãÆ |         ‚ãÆ        |     ‚ãÆ     |   ‚ãÆ   |        ‚ãÆ       |       ‚ãÆ       |        ‚ãÆ        |        ‚ãÆ        |
|  0 |         0        |     0     |   0   |        0       |       0       |        0        |        0        |
|----+------------------+-----------+-------+----------------+---------------+-----------------+-----------------|
|  s |  ‚ü¶Œ¶_blake_data‚üß  |     12    |   0   |    h_0 , h_1   |       1       |                 |                 |
|  s |  ‚ü¶Œ¶_blake_data‚üß  |     12    |   1   |    h_2 , h_3   |       1       |                 |                 |
|  s |  ‚ü¶Œ¶_blake_data‚üß  |     12    |   2   |    h_4 , h_5   |       1       |                 |                 |
|  s |  ‚ü¶Œ¶_blake_data‚üß  |     12    |   3   |    h_6 , h_7   |       1       |                 |                 |
|  s |  ‚ü¶Œ¶_blake_data‚üß  |     12    |   4   |    m_0 , m_1   |       1       |                 |                 |
|  s |  ‚ü¶Œ¶_blake_data‚üß  |     12    |   5   |    m_2 , m_3   |       1       |                 |                 |
|  s |  ‚ü¶Œ¶_blake_data‚üß  |     12    |   6   |    m_4 , m_5   |       1       |                 |                 |
|  ‚ãÆ |         ‚ãÆ        |     ‚ãÆ     |   ‚ãÆ   |        ‚ãÆ       |       ‚ãÆ       |                 |                 |
|  s |  ‚ü¶Œ¶_blake_data‚üß  |     12    |   11  |   m_14 , m_15  |       1       |                 |                 |
|  s |  ‚ü¶Œ¶_blake_data‚üß  |     12    |   12  | t_low , t_high |       1       |                 |                 |
|----+------------------+-----------+-------+----------------+---------------+-----------------+-----------------|
|  s | ‚ü¶Œ¶_blake_params‚üß |     1     |   0   |        r       |               |        1        |                 |
|  s | ‚ü¶Œ¶_blake_params‚üß |     1     |   1   |        f       |               |        1        |                 |
|----+------------------+-----------+-------+----------------+---------------+-----------------+-----------------|
|  s |   ‚ü¶Œ¶_blake_res‚üß  |     3     |   0   |      res_3     |               |                 |        1        |
|  s |   ‚ü¶Œ¶_blake_res‚üß  |     3     |   1   |      res_2     |               |                 |        1        |
|  s |   ‚ü¶Œ¶_blake_res‚üß  |     3     |   2   |      res_1     |               |                 |        1        |
|  s |   ‚ü¶Œ¶_blake_res‚üß  |     3     |   3   |      res_0     |               |                 |        1        |
|----+------------------+-----------+-------+----------------+---------------+-----------------+-----------------|
|----+------------------+-----------+-------+----------------+---------------+-----------------+-----------------|
| s' |  ‚ü¶Œ¶_blake_data‚üß  |     12    |   0   |   h_0' , h_1'  |       1       |                 |                 |
| s' |  ‚ü¶Œ¶_blake_data‚üß  |     12    |   1   |   h_2' , h_3'  |       1       |                 |                 |
| s' |  ‚ü¶Œ¶_blake_data‚üß  |     12    |   2   |   h_4' , h_5'  |       1       |                 |                 |
| s' |  ‚ü¶Œ¶_blake_data‚üß  |     12    |   3   |   h_6' , h_7'  |       1       |                 |                 |
| s' |  ‚ü¶Œ¶_blake_data‚üß  |     12    |   4   |   m_0' , m_1'  |       1       |                 |                 |
| s' |  ‚ü¶Œ¶_blake_data‚üß  |     12    |   5   |   m_2' , m_3'  |       1       |                 |                 |
|  ‚ãÆ |         ‚ãÆ        |     ‚ãÆ     |   ‚ãÆ   |        ‚ãÆ       |       ‚ãÆ       |                 |                 |

Let D ‚àà ùîπ[213] represent the input data slice. Inputs (i.e. call data) of the wrong size are weeded out in the HUB module and
don't make it to the present module. The ‚ü¶Œ¶_blake_params‚üß phase serves up the data of the integers r and f. These are defined
from input data as follows:

        r ‚â° D[0..4], r = [r0, r1, r2, r3]
        f ‚â° D[212]

They are respectively a 4 byte integer and a byte. If r > call_gas or f ‚àâ { 0, 1 } the data doesn't make it to the present
module' tracing. These are represented as the following integers in the traces

        r ‚áî 0x 00 00 00 00 00 00 00 00 00 00 00 00 r0 r1 r2 r3
        f ‚áî 0x 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  f

NOTE. the final byte is the value of the BLAKE parameter f (0 or 1) not the hex value "0x 0f" (15).
There are then the data fields. We take the input data I

        I ‚â° D[4..212] ‚àà ùîπ[208]

and chop it up into thirteen 16-byte slices as follows

        I[0..16]    ‚àà ùîπ[16]
        I[16..32]   ‚àà ùîπ[16]
                 ‚ãÆ
        I[192..208] ‚àà ùîπ[16]

These get written in the 13 consecutive rows of the ‚ü¶Œ¶_blake_data‚üß phase.

NOTE. What we have represented above as "h_0, h_1" etc is the concatenation of the 8 byte integers that underlie these values.
See [EYP].

The result of BLAKE2f is a slice of bytes res ‚àà ùîπ[64] which the present module serves up as four 16 byte slices res_k ‚àà ùîπ[16]

        res_3 ‚â° res[ 0..16]
        res_2 ‚â° res[16..32]
        res_1 ‚â° res[32..48]
        res_0 ‚â° res[48..64]
\end{verbatim}

\end{document}


