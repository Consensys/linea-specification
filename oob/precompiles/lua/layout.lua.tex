% !TeX TS-program = lualatex
\documentclass[varwidth=\maxdimen,margin=0.5cm,multi={verbatim}]{standalone}

\usepackage{fontspec}
\directlua{luaotfload.add_fallback
   ("emojifallback",
    {
      "NotoColorEmoji:mode=harf;"
    }
   )}

\usepackage{../../../pkg/draculatheme}

\setmonofont{JetBrains Mono NL Regular}[
  RawFeature={fallback=emojifallback}
]

\begin{document}
\begin{verbatim}
                   ██\   ██\ ██\   ██\ ███████\              ██\        ██████\   ██████\  ███████\        ██\            ██\                          ██████\                               
                   ██ |  ██ |██ |  ██ |██  __██\            ██  |      ██  __██\ ██  __██\ ██  __██\       \__|           ██ |                        ██  __██\                              
                   ██ |  ██ |██ |  ██ |██ |  ██ |          ██  /       ██ /  ██ |██ /  ██ |██ |  ██ |      ██\ ███████\ ██████\    ██████\   ██████\  ██ /  \__|██████\   ███████\  ██████\  
                   ████████ |██ |  ██ |███████\ |         ██  /        ██ |  ██ |██ |  ██ |███████\ |      ██ |██  __██\\_██  _|  ██  __██\ ██  __██\ ████\     \____██\ ██  _____|██  __██\ 
                   ██  __██ |██ |  ██ |██  __██\         ██  /         ██ |  ██ |██ |  ██ |██  __██\       ██ |██ |  ██ | ██ |    ████████ |██ |  \__|██  _|    ███████ |██ /      ████████ |
                   ██ |  ██ |██ |  ██ |██ |  ██ |       ██  /          ██ |  ██ |██ |  ██ |██ |  ██ |      ██ |██ |  ██ | ██ |██\ ██   ____|██ |      ██ |     ██  __██ |██ |      ██   ____|
                   ██ |  ██ |\██████  |███████  |      ██  /            ██████  | ██████  |███████  |      ██ |██ |  ██ | \████  |\███████\ ██ |      ██ |     \███████ |\███████\ \███████\ 
                   \__|  \__| \______/ \_______/       \__/             \______/  \______/ \_______/       \__|\__|  \__|  \____/  \_______|\__|      \__|      \_______| \_______| \_______|


                                                                                                                _)  |             
                                                                __ \    __|  _ \   __|   _ \   __ `__ \   __ \   |  |   _ \   __| 
                                                                |   |  |     __/  (     (   |  |   |   |  |   |  |  |   __/ \__ \ 
                                                                .__/  _|   \___| \___| \___/  _|  _|  _|  .__/  _| _| \___| ____/ 
                                                               _|                                        _|

|---------------------------+------------+------------+---------------+---------------------------+-------------------------------+----------------------------+----------------------------+----------------------------+------------|
| OOB_INST                  | OOB_DATA_1 | OOB_DATA_2 | OOB_DATA_3    | OOB_DATA_4                | OOB_DATA_5                    | OOB_DATA_6                 | OOB_DATA_7                 | OOB_DATA_8                 | OOB_DATA_9 |
|---------------------------+------------+------------+---------------+---------------------------+-------------------------------+----------------------------+----------------------------+----------------------------+------------|
| ⟦OOB_INST_ecrecover⟧      | callee_gas | cds        | r@c           | hub_success ≡             | return_gas ≡                  | extract_call_data ≡        | empty_call_data ≡          | r@c_nonzero ≡              |            |
| ⟦OOB_INST_sha2-256⟧       |            |            |               | . [gas_cost ≤ callee_gas] | . 0 ∨ [callee_gas - gas_cost] | .   hub_success            | .   hub_success            | .   [r@c ≠ 0]              |            |
| ⟦OOB_INST_ripemd-160⟧     |            |            |               |                           |                               | .   ∧ [cds ≠ 0]            | .   ∧ [cds = 0]            |                            |            |
| ⟦OOB_INST_identity⟧       |            |            |               |                           |                               |                            |                            |                            |            |
| ⟦OOB_INST_ecadd⟧          |            |            |               |                           |                               |                            |                            |                            |            |
| ⟦OOB_INST_ecmul⟧          |            |            |               |                           |                               |                            |                            |                            |            |
|                           | ✓ trusted  | ✓ trusted  | ✓ trusted     | ⟦ π ⟧                     | ⟦ π ⟧                         | ⟦ π ⟧                      | ⟦ π ⟧                      | ⟦ π ⟧                      |            |
|---------------------------+------------+------------+---------------+---------------------------+-------------------------------+----------------------------+----------------------------+----------------------------+------------|
| ⟦OOB_INST_ecpairing⟧      | callee_gas | cds        | r@c           | hub_success ≡             | return_gas ≡                  | extract_call_data ≡        | empty_call_data ≡          | r@c_nonzero ≡              |            |
| ⟦OOB_INST_bls12_*⟧        |            |            |               | . [gas_cost ≤ callee_gas] | . 0 ∨ [callee_gas - gas_cost] | .   hub_success            | .   hub_success            | .   [r@c ≠ 0]              |            |
|                           |            |            |               | . ∧ [cds is valid]        | . (if hub_success ≡ true)     | .   ∧ [cds ≠ 0]            | .   ∧ [cds = 0]            |                            |            |
|                           |            |            |               |                           |                               |                            |                            |                            |            |
|                           | ✓ trusted  | ✓ trusted  | ✓ trusted     | ⟦ π ⟧                     | ⟦ π ⟧                         | ⟦ π ⟧                      | ⟦ π ⟧                      | ⟦ π ⟧                      |            |
|---------------------------+------------+------------+---------------+---------------------------+-------------------------------+----------------------------+----------------------------+----------------------------+------------|
|---------------------------+------------+------------+---------------+---------------------------+-------------------------------+----------------------------+----------------------------+----------------------------+------------|
| ⟦OOB_INST_modexp_cds⟧     |            | cds        | extract_bbs ≡ | extract_ebs ≡             | extract_mbs ≡                 |                            |                            |                            |            |
|                           |            |            | .   [0 < cds] | .   [32 < cds]            | .   [64 < cds]                |                            |                            |                            |            |
|                           |            |            |               |                           |                               |                            |                            |                            |            |
|                           |            | ✓ trusted  | ⟦ π ⟧         | ⟦ π ⟧                     | ⟦ π ⟧                         |                            |                            |                            |            |
|---------------------------+------------+------------+---------------+---------------------------+-------------------------------+----------------------------+----------------------------+----------------------------+------------|
| ⟦OOB_INST_modexp_xbs⟧     | xbs_hi     | xbs_lo     | ybs_lo        | do_compute_max            |                               |                            | max ≡                      | xbs_nonzero ≡              |            |
|                           |            |            |               |                           |                               |                            | .      xbs ∨ ybs           | .      [xbs ≠ 0]           |            |
|                           |            |            |               |                           |                               |                            | (if do_compute_max ≡ true) | (if do_compute_max ≡ true) |            |
|                           |            |            |               |                           |                               |                            |                            |                            |            |
|                           | ✓ trusted  | ✓ trusted  | ✓ trusted     | ✓ trusted                 |                               |                            | ⟦ π ⟧                      | ⟦ π ⟧                      |            |
|---------------------------+------------+------------+---------------+---------------------------+-------------------------------+----------------------------+----------------------------+----------------------------+------------|
| ⟦OOB_INST_modexp_lead⟧    | bbs_lo     | cds        | ebs_lo        | load_lead ≡               |                               | lead_calldata_bytes ≡      | lead_exponent_bytes ≡      | ebs_sub_32 ≡               |            |
|                           |            |            |               | .   [cds > 96 + bbs]      |                               | .   [0 ∨ [cds - 96 - bbs]] | .   ebs ∧ 32               | .   0 ∨ [ebs - 32]         |            |
|                           |            |            |               | .   ∧ [ebs ≠ 0]           |                               | .   ∧ 32                   |                            |                            |            |
|                           |            |            |               |                           |                               |                            |                            |                            |            |
|                           | ✓ trusted  | ✓ trusted  | ✓ trusted     | ⟦ π ⟧                     |                               | ⟦ π ⟧                      | ⟦ π ⟧                      | ⟦ π ⟧                      |            |
|---------------------------+------------+------------+---------------+---------------------------+-------------------------------+----------------------------+----------------------------+----------------------------+------------|
| ⟦OOB_INST_modexp_pricing⟧ | callee_gas |            | r@c           | ram_success ≡             | return_gas ≡                  | exponent_log               | max_mbs_bbs                | r@c_nonzero ≡              |            |
|                           |            |            |               | . [gas_cost ≤ callee_gas] | . 0 ∨ [callee_gas - gas_cost] |                            |                            | .   [r@c ≠ 0]              |            |
|                           |            |            |               |                           |                               |                            |                            |                            |            |
|                           | ✓ trusted  |            | ✓ trusted     | ⟦ π ⟧                     | ⟦ π ⟧                         | ✓ trusted                  | ✓ trusted                  | ⟦ π ⟧                      |            |
|---------------------------+------------+------------+---------------+---------------------------+-------------------------------+----------------------------+----------------------------+----------------------------+------------|
| ⟦OOB_INST_modexp_extract⟧ |            | cds        | bbs_lo        | ebs_lo                    | mbs_lo                        | base_extraction ≡          | exponent_extraction ≡      | modulus_extraction ≡       |            |
|                           |            |            |               |                           |                               | .   modulus_extraction     | .   modulus_extraction     | .   [cds > 96 + bbs + ebs] |            |
|                           |            |            |               |                           |                               | .   ∧ [bbs ≠ 0]            | .   ∧ [ebs ≠ 0]            | .   ∧ [mbs ≠ 0]            |            |
|                           |            |            |               |                           |                               |                            |                            |                            |            |
|                           |            | ✓ trusted  | ✓ trusted     | ✓ trusted                 | ✓ trusted                     | ⟦ π ⟧                      | ⟦ π ⟧                      | ⟦ π ⟧                      |            |
|---------------------------+------------+------------+---------------+---------------------------+-------------------------------+----------------------------+----------------------------+----------------------------+------------|
|---------------------------+------------+------------+---------------+---------------------------+-------------------------------+----------------------------+----------------------------+----------------------------+------------|
| ⟦OOB_INST_blake_cds⟧      |            | cds        | r@c           | hub_success ≡             |                               |                            |                            | r@c_nonzero ≡              |            |
|                           |            |            |               | .   [cds = 213]           |                               |                            |                            | .   [r@c ≠ 0]              |            |
|                           |            |            |               |                           |                               |                            |                            |                            |            |
| (we could merge it        |            |            |               |                           |                               |                            |                            |                            |            |
| with others)              |            | ✓ trusted  | ✓ trusted     | ⟦ π ⟧                     |                               |                            |                            | ⟦ π ⟧                      |            |
|---------------------------+------------+------------+---------------+---------------------------+-------------------------------+----------------------------+----------------------------+----------------------------+------------|
| ⟦OOB_INST_blake_params⟧   | callee_gas |            |               | ram_success ≡             | return_gas ≡                  | r                          | f                          |                            |            |
|                           |            |            |               | .   [r ≤ callee_gas]      | .   0 ∨ [callee_gas - r]      |                            |                            |                            |            |
|                           |            |            |               | .   ∧ [f ≡ bit]           |                               |                            |                            |                            |            |
|                           |            |            |               |                           |                               |                            |                            |                            |            |
|                           | ✓ trusted  |            |               | ⟦ π ⟧                     | ⟦ π ⟧                         | ✓ trusted                  | ✓ trusted                  |                            |            |
|---------------------------+------------+------------+---------------+---------------------------+-------------------------------+----------------------------+----------------------------+----------------------------+------------|

Comments: 
- callee_gas, cds and r@c always occupy the same columns (when present);
- return_gas, r@c_nonzero and hub_success/ram_success always occupy the same columns (when present);
- ⟦OOB_INST_bls12_*⟧ is a placeholder for all BLS12-* precompiles;
- [cds is valid] is a placeholder for the validity of cds and it is instruction dependent:
        * ⟦OOB_INST_ecpairing⟧: [cds ≡ 0 mod 192]
        * ⟦OOB_INST_bls12_g1add⟧, ⟦OOB_INST_bls12_g2add⟧, ⟦OOB_INST_bls12_map_fp_to_g1⟧, ⟦OOB_INST_bls12_map_fp2_to_g2⟧: [cds = fixed_size] where fixed_size = 256, 512, 64, 128 respectively  
        * ⟦OOB_INST_bls12_g1msm⟧, ⟦OOB_INST_bls12_g2msm⟧: [cds ≡ 0 mod msm_size] where msm_size = 160, 288 respectively
        * ⟦OOB_INST_bls12_pairing_check⟧: [cds ≡ 0 mod 384]
- the data layout for
        * ⟦OOB_ecrecover⟧        * ⟦OOB_sha2-256⟧         * ⟦OOB_ecpairing⟧
        * ⟦OOB_ecadd⟧            * ⟦OOB_ripemd-160⟧       * ⟦OOB_INST_bls12_*⟧              
        * ⟦OOB_ecmul⟧            * ⟦OOB_identity⟧
  is precisely the same;
- the ``⟦ π ⟧'' label applies to HUB-module PREDICTIONS which the OOB module is tasked with justifying;

While the data layout is the same the underlying computations performed by the OOB module are distinct
- the "gas_cost" computation are precompile specific;
- the "hub_success" condition are always just [callee_gas ≤ gas_cost] except for ⟦OOB_ecpairing⟧ which also requires a congruence condition.

NOTE. ECADD, ECMUL and ECPAIRING can have hard failures unrelated to insufficient gas induced by MALFORMED DATA.
Detection of these, however, requires reading input data from RAM. Such failures will be detected by the SCEN/PRC_FAILURE_KNOWN_TO_RAM 
\end{verbatim}
\end{document}
