\[
	\boxed{\text{All constraints in this subsection further assume } \oobInstIsModexpPricing _{i} = 1}
\]
The purpose of the present \oobMod{} instruction is to compute the pricing of the
\instModexp{} precompile.
We follow the pricing model of \cite{EIP-7883}.
We use the shorthands defined below:
\[
	\left\{ \begin{array}{lclr}
		\locCalleeGas    & \define & \oobDataCol{1} _{i} \\
		% \locCds        & \define & \oobDataCol{2} _{i} \\
		\locRac          & \define & \oobDataCol{3} _{i} \\
		\locRamSuccess   & \define & \oobDataCol{4} _{i}  & \quad \prediction \\
		\locReturnGas    & \define & \oobDataCol{5} _{i}  & \quad \prediction \\
		\locExponentLog  & \define & \oobDataCol{6} _{i} \\
		\locMaxMbsBbs    & \define & \oobDataCol{7} _{i} \\
		\locRacIsNonzero & \define & \oobDataCol{8} _{i}  & \quad \prediction \\
	\end{array} \right.
\]
\hubPredictionDecoratorBlurb{}

\saNote{}
The intended interpretation is that $\locExponentLog$ contain $\locExponentLogEYP$ as defined in \cite{EIP-7883}.
The value of \locExponentLog{} is partly computed in the \expMod{} module using a specialized instruction,
and ``completed'' in the \hubMod{},
see~(\ref{hub: instruction handling: call: precompiles: modexp: common constraints}).

\saNote{}
The intended interpretation of \locMaxMbsBbs{} is $\max(\locBase, \locModulus)$.
As such \locFOfMax{}, which will be defined below, computes
$\displaystyle f\big(\max(\locBase, \locModulus)\big) = \left\lceil\frac{\max(\locBase, \locModulus)}{8}\right\rceil^2$.

We impose the following:
\begin{description}
	\item[\underline{Rows
		$n^\circ(i + \roffModexpPricingRacZeronessTest              )$,
		$n^\circ(i + \roffModexpPricingExponentLogZeronessTest      )$,
		$n^\circ(i + \roffModexpPricingMaxMbsBbsCeilingComputation  )$ and
		$n^\circ(i + \roffModexpPricingMaxMbsBbsVsSixteenComparison )$:}] we impose
		we impose that
		\[
			\left\{ \begin{array}{l}
				\wcpCallToIszero {
					anchorRow = i                                 ,
					relOffset = \roffModexpPricingRacZeronessTest ,
					argOneHi  = 0                                 ,
					argOneLo  = \locRac                           ,
				}
				\vspace{2mm} \\
				\wcpCallToIszero {
					anchorRow = i                                         ,
					relOffset = \roffModexpPricingExponentLogZeronessTest ,
					argOneHi  = 0                                         ,
					argOneLo  = \locExponentLog                           ,
				}
				\vspace{2mm} \\
				\callToDiv {
					anchorRow  = i                                             ,
					relOffset  = \roffModexpPricingMaxMbsBbsCeilingComputation ,
					dividendHi = 0                                             ,
					dividendLo = \locMaxMbsBbs + 7                             ,
					divisorHi  = 0                                             ,
					divisorLo  = 8                                             ,
				}
				\vspace{2mm} \\
				\wcpCallToLt {
					anchorRow = i                                              ,
					relOffset = \roffModexpPricingMaxMbsBbsVsSixteenComparison ,
					argOneHi  = 0                                              ,
					argOneLo  = \evmWordSize                                   ,
					argTwoHi  = 0                                              ,
					argTwoLo  = \locMaxMbsBbs                                  ,
				}
				\\
			\end{array} \right.
		\]
		we define the following associated shorthands
		\[
			\left\{ \begin{array}{lcl}
				\locRacIsZero             & \define & \outgoingResLo _{i + \roffModexpPricingRacZeronessTest              } \\
				\locExponentLogIsZero     & \define & \outgoingResLo _{i + \roffModexpPricingExponentLogZeronessTest      } \\
				\locCeilingOfMaxOverEight & \define & \outgoingResLo _{i + \roffModexpPricingMaxMbsBbsCeilingComputation  } \\
				\locWordCostDominates     & \define & \outgoingResLo _{i + \roffModexpPricingMaxMbsBbsVsSixteenComparison } \\
			\end{array} \right.
		\]
		Thus, by definition
		\begin{enumerate}
			\item $\locRacIsZero             = \true$ \emph{iff} $\locRac         = 0$
		        \item $\locExponentLogIsZero     = \true$ \emph{iff} $\locExponentLog = 0$
		        \item $\locCeilingOfMaxOverEight        $ computes   $\displaystyle \left\lceil\frac{\locMaxMbsBbs}{8}\right\rceil$
		        \item $\locWordCostDominates     = \true$ \emph{iff} $\evmWordSize    < \locMaxMbsBbs$
		\end{enumerate}
		We further set
		\begin{enumerate}
			\item $\locFOfMax \define \locCeilingOfMaxOverEight \cdot \locCeilingOfMaxOverEight$
			\item \If $\locWordCostDominates = \false $ \Then \( \locMultiplicationComplexity \define \locMinMultiplicationComplexityValue \)
			\item \If $\locWordCostDominates = \true  $ \Then \( \locMultiplicationComplexity \define 2 \cdot \locFOfMax                   \)
			\item \If $\locExponentLogIsZero = \false $ \Then \( \locIterationCountOrOne      \define \locExponentLog                      \)
			\item \If $\locExponentLogIsZero = \true  $ \Then \( \locIterationCountOrOne      \define \locMinIterationCountValue           \)
		\end{enumerate}
\end{description}
We define
\[
	\locComplexityTimesIterationCount
	\define
	\left[ \begin{array}{cl}
		\cdot & \locMultiplicationComplexity \\
		\cdot & \locIterationCountOrOne      \\
	\end{array} \right]
\]
\begin{description}
	\item[\underline{Rows
		$n^°(i + \roffModexpPricingComparisonToFiveHundred      )$ and
		$n^°(i + \roffModexpPricingGasCostVsCalleeGasComparison )$:}]
		we impose that
		\[
			\left\{ \begin{array}{l}
				\wcpCallToLt {
					anchorRow = i                                         ,
					relOffset = \roffModexpPricingComparisonToFiveHundred ,
					argOneHi  = 0                                         ,
					argOneLo  = \locComplexityTimesIterationCount         ,
					argTwoHi  = 0                                         ,
					argTwoLo  = 500                                       ,
				}
				\vspace{2mm} \\
				\wcpCallToLt {
					anchorRow = i                                              ,
					relOffset = \roffModexpPricingGasCostVsCalleeGasComparison ,
					argOneHi  = 0                                              ,
					argOneLo  = \locCalleeGas                                  ,
					argTwoHi  = 0                                              ,
					argTwoLo  = \locPrecompileCost                             ,
				}
				\\
			\end{array} \right.
		\]
		we define the \locBigQuotientLtFiveHundred{} shorthand
		\[
			\locBigQuotientLtFiveHundred \define \outgoingResLo _{i + \roffModexpPricingComparisonToFiveHundred}
		\]
		from which we define the \locPrecompileCost{} shorthand used above
		\begin{enumerate}
			\item \If $\locBigQuotientLtFiveHundred = 0$ \Then $\locPrecompileCost \define \locBigQuotient$
			\item \If $\locBigQuotientLtFiveHundred = 1$ \Then $\locPrecompileCost \define 500$
		\end{enumerate}
	\item[\underline{Justifying \hubMod{} predictions:}] we impose that
		\begin{description}
			\item[{Constraining \locRamSuccess:}]
				we impose that
				\[
					\locRamSuccess = 1 - \outgoingResLo _{i + \roffModexpPricingGasCostVsCalleeGasComparison}
				\]
			\item[{Constraining \locReturnGas:}]
				we impose that
				\begin{enumerate}
					\item \If $\locRamSuccess = 0$ \Then $\locReturnGas = 0$
					\item \If $\locRamSuccess = 1$ \Then $\locReturnGas = \locCalleeGas - \locPrecompileCost$
				\end{enumerate}
			\item[{Constraining \locRacIsNonzero:}]
				we impose that
				\[
					\locRacIsNonzero = 1 - \locRacIsZero
				\]
		\end{description}
\end{description}
