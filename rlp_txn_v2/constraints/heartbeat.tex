
We define the following shorthands on the perspective flags:
\[
    \locPerspFlagSum_{i} \define
    \left[ \begin{array}{cr}
        + & \isTxn_{i}    \\
        + & \isCmp_{i}    \\
    \end{array} \right]
\]

And on the phase flags:
\[
    \locPhaseFlagSum_{i} \define
    \left[ \begin{array}{cr}
        + & \phaseRlpPrefix_{i}    \\
        + & \phaseChainId_{i}    \\
        + & \phaseNonce_{i}    \\
        + & \phaseGasPrice_{i}    \\
        + & \phaseMaxPriorityFeePerGas_{i}    \\
        + & \phaseMaxFeePerGas_{i}    \\
        + & \phaseGasLimit_{i}    \\
        + & \phaseTo_{i}    \\
        + & \phaseValue_{i}    \\
        + & \phaseData_{i}    \\
        + & \phaseAccessList_{i}    \\
        + & \phaseBeta_{i}    \\
        + & \phaseY_{i}    \\
        + & \phaseR_{i}    \\
        + & \phaseS_{i}    \\
    \end{array} \right]
\]
and impose the following:
\begin{enumerate}
    \item \If $\absTxNum_{i} = 0$ \Then:
    \begin{enumerate}
         \item $\locPerspFlagSum_{i} = 0$
         \item $\locPhaseFlagSum_{i} = 0$
         \item $\lc_{i} = 0$ (\trash)
     \end{enumerate} 
    \item \If $\absTxNum_{i} \neq 0$ \Then: 
    \begin{enumerate}
         \item $\locPerspFlagSum_{i} = 1$
         \item $\locPhaseFlagSum_{i} = 1$
     \end{enumerate}
\end{enumerate}
In other words, when not in padding, you must be in one and only perspective (resp. phase) at a time.
\newline
We define the following shorthand:
\[
    \locTransactionStarts_{i} \define \phaseRlpPrefix_{i} \cdot \isTxn_{i}
\]

\begin{enumerate}[resume]
\item $\absTxNum_{i} = \absTxNum_{i-1} + \locTransactionStarts_{i}$
\end{enumerate}
In other words $\absTxNum$ is constant except increasing by one when starting a new transaction.
\newline
We define the following shorthands:
\[
    \locPossiblePhaseTransition_{i} \define
    \left[ \begin{array}{crrr}
        + & \phaseRlpPrefix           _{i} & \cdot \typeZeroTx{}                  & \cdot \phaseNonce               _{i + 1} \\
        + & \phaseRlpPrefix           _{i} & \cdot (\typeOneTx{} + \typeTwoTx{})  & \cdot \phaseChainId             _{i + 1} \\
        + & \phaseChainId             _{i} &                                      & \cdot \phaseNonce               _{i + 1} \\
        + & \phaseNonce               _{i} & \cdot (\typeZeroTx{} + \typeOneTx{}) & \cdot \phaseGasPrice            _{i + 1} \\
        + & \phaseNonce               _{i} & \cdot \typeTwoTx{})                  & \cdot \phaseMaxPriorityFeePerGas_{i + 1} \\
        + & \phaseGasPrice            _{i} &                                      & \cdot \phaseGasLimit            _{i + 1} \\
        + & \phaseMaxPriorityFeePerGas_{i} &                                      & \cdot \phaseMaxFeePerGas        _{i + 1} \\
        + & \phaseMaxFeePerGas        _{i} &                                      & \cdot \phaseGasLimit            _{i + 1} \\
        + & \phaseGasLimit            _{i} &                                      & \cdot \phaseTo                  _{i + 1} \\
        + & \phaseTo                  _{i} &                                      & \cdot \phaseValue               _{i + 1} \\
        + & \phaseValue               _{i} &                                      & \cdot \phaseData                _{i + 1} \\
        + & \phaseData                _{i} & \cdot \typeZeroTx{}                  & \cdot \phaseBeta                _{i + 1} \\
        + & \phaseData                _{i} & \cdot (\typeOneTx{} + \typeTwoTx{})  & \cdot \phaseAccessList          _{i + 1} \\
        + & \phaseAccessList          _{i} &                                      & \cdot \phaseY                   _{i + 1} \\
        + & \phaseBeta                _{i} &                                      & \cdot \phaseR                   _{i + 1} \\
        + & \phaseY                   _{i} &                                      & \cdot \phaseR                   _{i + 1} \\
        + & \phaseR                   _{i} &                                      & \cdot \phaseS                   _{i + 1} \\
        + & \phaseS                   _{i} &                                      & \cdot \phaseRlpPrefix           _{i + 1} \\
    \end{array} \right]
\]
and
\[
    \locWeightedPhaseFlag_{i} \define
    \left[ \begin{array}{crrr}
        + & \phaseRlpPrefix           _{i} & \cdot & 2^{0 } \\
        + & \phaseChainId             _{i} & \cdot & 2^{1 } \\
        + & \phaseNonce               _{i} & \cdot & 2^{2 } \\
        + & \phaseGasPrice            _{i} & \cdot & 2^{3 } \\
        + & \phaseMaxPriorityFeePerGas_{i} & \cdot & 2^{4 } \\
        + & \phaseMaxFeePerGas        _{i} & \cdot & 2^{5 } \\
        + & \phaseGasLimit            _{i} & \cdot & 2^{6 } \\
        + & \phaseTo                  _{i} & \cdot & 2^{7 } \\
        + & \phaseValue               _{i} & \cdot & 2^{8 } \\
        + & \phaseData                _{i} & \cdot & 2^{9 } \\
        + & \phaseAccessList          _{i} & \cdot & 2^{10} \\
        + & \phaseBeta                _{i} & \cdot & 2^{11} \\
        + & \phaseY                   _{i} & \cdot & 2^{12} \\
        + & \phaseR                   _{i} & \cdot & 2^{13} \\
        + & \phaseS                   _{i} & \cdot & 2^{14} \\
    \end{array} \right]
\]
And we impose:
\begin{enumerate}[resume]
    \item \If ($\phasend_{i} = 0$ \et $\locPhaseFlagSum_{i} = 1$) \Then $\locWeightedPhaseFlag_{i} =  \locWeightedPhaseFlag_{i+1}$
    \item $\phasend_{i} = \locPossiblePhaseTransition_{i}$
\end{enumerate}
In other words, a phase transition happens if and only if $\phasend_{i} = 1$ and means $\phase{p}_{i} = 1$ and $\phase{q}_{i + 1} = 1$ with the only given possibility for p and q, depending of $\txType$: 

\begin{table}[h]
    \centering
    \begin{tabular}{|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|} \hline
        $\phase{p}_{i}$                         & 0 & 1 & 2 & 3 & 4 & 5 & 6 & 7 & 8 & 9  & 10 & 11 & 12 & 13 & 14 \\ \hline \hline
        $\phase{q}_{i + 1}$ (for $\txType = 0$) & 2 &   & 3 & 6 &   &   & 7 & 8 & 9 & 11 &    & 13 &    & 14 & 0  \\ \hline
        $\phase{q}_{i + 1}$ (for $\txType = 1$) & 1 & 2 & 3 & 6 &   &   & 7 & 8 & 9 & 10 & 12 &    & 13 & 14 & 0  \\ \hline
        $\phase{q}_{i + 1}$ (for $\txType = 2$) & 1 & 2 & 4 &   & 5 & 6 & 7 & 8 & 9 & 10 & 12 &    & 13 & 14 & 0  \\ \hline
    \end{tabular}
    \caption{Possible phase transition}
    \label{tab:Possible phase transition}
\end{table}

We further impose that a phase alwats start with a transaction-row:
\begin{enumerate}[resume]
    \item $\phasend_{i} = 1$ \Then $\isTxn_{i+1} = 1$
\end{enumerate}

Intra phase heartbeat:
\begin{enumerate}[resume]
    \item \If $\ct_{i} \neq \maxCt_{i}$ \Then $\done_{i} = 0$
    \item \If $\ct_{i} =    \maxCt_{i}$ \Then $\done_{i} = 1$
    \item \If $\done_{i} = 0$ \Then:
    \begin{enumerate}
        \item $\ct_{i+1} = 1 + \ct_{i}$ 
        \item $\phasend_{i} = 0$
    \end{enumerate}
    \item \If $\done_{i} = 0$ \Then: $\ct_{i+1} = 0$
\end{enumerate}

Finalization:
\begin{enumerate}[resume]
    \item \If $\absTxNum_{N} \neq 0$ \Then
    \begin{enumerate}
        \item $\phasend_{N} = 1$
        \item $\phaseS_{N} = 1$ 
    \end{enumerate}
\end{enumerate}
In other words, we constrain the last row of the trace to be the end of the last phase of a transaction.