# Shomei triggers

| scenario | instruction  | subscenario | account           | storage               | SHOMEI_TRIGGER        | Notes                                    |
|----------|--------------|-------------|:------------------|:----------------------|:----------------------|------------------------------------------|
| TX_SKIP  |              |             | sender            |                       | ✓                     |
|          |              |             | recipient         |                       | if nonzero value: ✓   |
|          |              |             |                   |                       | if zero value: ?      |
|          |              |             | coinbase          |                       | ✓                     |
|----------|--------------|-------------|-------------------|-----------------------|-----------------------|
| TX_WARM  |              |             | acc. list address |                       | ✗                     |
|          |              |             |                   | acc. list storage key | ✗                     |
|          |              |             |                   |                       |                       |
|          |              |             |                   |                       |                       |
|----------|--------------|-------------|-------------------|-----------------------|-----------------------|
| TX_INIT  |              |             | sender            |                       | ✓                     |
|          |              |             | recipient         |                       | ✓                     |
|          |              |             | (coinbase)        |                       | not today             |
|          |              |             |                   |                       | pre-warmed for Prague |
|----------|--------------|-------------|-------------------|-----------------------|-----------------------|
| TX_FINL  |              |             | sender            |                       | ✓                     |
|          |              |             | coinbase          |                       | ✓                     |
|----------|--------------|-------------|-------------------|-----------------------|-----------------------|
| TX_EXEC  |              |             |                   |                       |                       |
|----------|--------------|-------------|-------------------|-----------------------|-----------------------|
|          | any          | SUX/SOX     | ✗                 | ✗                     |                       |
|----------|--------------|-------------|-------------------|-----------------------|-----------------------|------------------------------------------|
|          | SELFBALANCE  |             |                   |                       | ∅                     | irrelevant: the underlying               |
|          |              |             |                   |                       |                       | account has already been loaded          |
|----------|--------------|-------------|-------------------|-----------------------|-----------------------|------------------------------------------|
|          | BALANCE      | OOGX        | (trimmed) address |                       |                       | only the warmth matters to price         |
|          | EXTCODESIZE  |             |                   |                       |                       | this opcode                              |
|          | EXTCODEHASH  |             |                   |                       |                       |                                          |
|          |              |             |                   |                       |                       | Question: what happens if the            |
|          |              |             |                   |                       |                       | account does not exist in the state ?    |
|          |              | XAHOY ≡ 0   |                   |                       |                       |                                          |
|----------|--------------|-------------|-------------------|-----------------------|-----------------------|------------------------------------------|
|          | EXTCODECOPY  | MXPX        |                   |                       |                       |
|          |              |             |                   |                       |                       |
|          |              | OOGX        |                   |                       |                       |
|          |              |             |                   |                       |                       |
|          |              | XAHOY ≡ 0   |                   |                       |                       |
|----------|--------------|-------------|-------------------|-----------------------|-----------------------|------------------------------------------|
|          | CODESIZE     | JUMPX       |                   |                       | ∅                     | The underlying account must have already |
|          | CODECOPY     | OOGX        |                   |                       |                       | been loaded by Besu/Shomei               |
|          | JUMP         |             |                   |                       |                       |                                          |
|          | JUMPI        | XAHOY ≡ 0   |                   |                       |                       |                                          |
|----------|--------------|-------------|-------------------|-----------------------|-----------------------|------------------------------------------|
|          | CALL         | STATICX     |                   |                       |                       |
|          | CALLCODE     | (CALL only) |                   |                       |                       |
|          | DELEGATECALL |             |                   |                       |                       |
|          | STATICCALL   | MXPX        |                   |                       |                       |
|          |              |             |                   |                       |                       |
|          |              | OOGX        |                   |                       |                       |
|          |              |             |                   |                       |                       |
|          |              |             |                   |                       |                       |
|----------|--------------|-------------|-------------------|-----------------------|-----------------------|
|          | CREATE       | STATICX     |                   |                       |                       |
|          | CREATE2      |             |                   |                       |                       |
|          |              | (MAXCSX)    |                   |                       |                       |
|          |              |             |                   |                       |                       |
|          |              | MXPX        |                   |                       |                       |
|          |              |             |                   |                       |                       |
|          |              | OOGX        |                   |                       |                       |
|          |              |             |                   |                       |                       |
|----------|--------------|-------------|-------------------|-----------------------|-----------------------|
|          | SELFDESTRUCT | STATICX     |                   |                       |                       |
|          |              |             |                   |                       |                       |
|          |              | OOGX        |                   |                       |                       |
|          |              |             |                   |                       |                       |
|----------|--------------|-------------|-------------------|-----------------------|-----------------------|
|          | STOP         |             |                   |                       |                       |
|          | REVERT       |             |                   |                       |                       |
|----------|--------------|-------------|-------------------|-----------------------|-----------------------|
|          | RETURN       |             |                   |                       |                       |
|----------|--------------|-------------|-------------------|-----------------------|-----------------------|

- TX_SKIP
    - sender required
    - recipient required ... if nonzero value :cry:
    - coinbase required
- TX_WARM
    - accounts aren't required
    - storage isn't required
- TX_INIT
- TX_FINL
- instruction processing
    - account rows
        - BALANCE
        - EXTCODESIZE
        - EXTCODEHASH
        - EXTCODECOPY
        - CODESIZE
        - CODECOPY
        - SELFBALANCE
        - JUMP
        - JUMPI
        - CALL
        - CALLCODE
        - DELEGATECALL
        - STATICCALL
        - CREATE
        - CREATE2
        - SELFDESTRUCT
        - STOP
        - RETURN
        - REVERT
    - storage rows
        - SSTORE
        - SLOAD
